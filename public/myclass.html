<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Smart Attendance</title>
  
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">

  <script>
    tailwind.config = {
        theme: {
            extend: {
                colors: {
                    // Your Sophisticated LUXE NOIR & SOFT OAT Palette
                    noir: '#060D0C',      // Deep luxe black
                    oat: '#F0EDE5',       // Soft warm cream
                    success: '#4CAF50',   // Success Green
                    error: '#E63946',     // Error Red
                },
                fontFamily: {
                    sans: ['Inter', 'system-ui', 'sans-serif'],
                }
            }
        }
    }
</script>
<style>
    body {
        font-family: 'Inter', system-ui, sans-serif;
        background: #F0EDE5; /* soft oat */
        color: #060D0C; /* luxe noir */
        -webkit-font-smoothing: antialiased;
        -moz-osx-font-smoothing: grayscale;
    }
    
    .glass-card {
        background: rgba(255, 255, 255, 0.8);
        backdrop-filter: blur(20px);
        border: 1px solid rgba(6, 13, 12, 0.08);
        box-shadow: 0 8px 32px rgba(6, 13, 12, 0.06);
    }

    /* Primary Button with Noir Elegance */
    .btn-primary {
        background: linear-gradient(135deg, #060D0C, #1a1f1e);
        color: #F0EDE5;
        transition: all 0.3s ease;
        transform: translateY(0);
        border: none;
    }

    .btn-primary:hover {
        background: linear-gradient(135deg, #000000, #060D0C);
        transform: translateY(-2px);
        box-shadow: 0 8px 25px rgba(6, 13, 12, 0.3);
    }

    /* Success Button */
    .btn-success {
        background: #4CAF50;
        color: white;
        transition: all 0.3s ease;
    }

    .btn-success:hover {
        background: #388e3c;
        transform: translateY(-1px);
        box-shadow: 0 4px 15px rgba(76, 175, 80, 0.3);
    }

    /* Error Button */
    .btn-error {
        background: #E63946;
        color: white;
        transition: all 0.3s ease;
    }

    .btn-error:hover {
        background: #c62828;
        transform: translateY(-1px);
        box-shadow: 0 4px 15px rgba(230, 57, 70, 0.3);
    }

    /* Secondary Button */
    .btn-secondary {
        background: rgba(6, 13, 12, 0.05);
        color: #060D0C;
        border: 1px solid rgba(6, 13, 12, 0.15);
        transition: all 0.2s ease;
    }

    .btn-secondary:hover {
        background: rgba(6, 13, 12, 0.1);
        border-color: rgba(6, 13, 12, 0.25);
        transform: translateY(-1px);
    }

    /* Tab Styles with Luxe Theme */
    .tablinks {
        color: rgba(6, 13, 12, 0.6);
        background: transparent;
        border-bottom: 2px solid transparent;
        transition: all 0.2s ease;
    }

    .tablinks:hover {
        color: #060D0C;
        background: rgba(6, 13, 12, 0.05);
    }

    .tablinks.active {
        color: #060D0C;
        border-bottom-color: #060D0C;
        background: rgba(6, 13, 12, 0.08);
        font-weight: 600;
    }

    .tabcontent {
        display: none;
        animation: fadeIn 0.3s ease-in;
    }

    .tabcontent.active {
        display: block;
    }

    @keyframes fadeIn {
        from { opacity: 0; transform: translateY(8px); }
        to { opacity: 1; transform: translateY(0); }
    }

    /* Form Inputs */
    .form-input {
        background: rgba(255, 255, 255, 0.95);
        border: 1px solid rgba(6, 13, 12, 0.15);
        color: #060D0C;
        transition: all 0.2s ease;
    }

    .form-input:focus {
        outline: none;
        border-color: #060D0C;
        background: rgba(255, 255, 255, 1);
        box-shadow: 0 0 0 3px rgba(6, 13, 12, 0.1);
    }

    /* Highlight Elements */
    .highlight {
        background: linear-gradient(135deg, #060D0C, #1a1f1e);
        color: #F0EDE5;
    }

    /* Luxe accent elements */
    .luxe-accent {
        background: rgba(6, 13, 12, 0.08);
        border: 1px solid rgba(6, 13, 12, 0.12);
    }

    /* Success/Error/Primary States */
    .success-state {
        background: rgba(76, 175, 80, 0.1);
        border-color: #4CAF50;
        color: #2e7d32;
    }

    .error-state {
        background: rgba(230, 57, 70, 0.1);
        border-color: #E63946;
        color: #c62828;
    }

    .primary-state {
        background: rgba(6, 13, 12, 0.05);
        border-color: #060D0C;
        color: #060D0C;
    }
/* ✅ COMPACT NOTIFICATION ANIMATIONS */
.notification {
  animation: slideDownCompact 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  max-width: 320px;
  min-width: 280px;
}

@keyframes slideDownCompact {
  from { 
    opacity: 0; 
    transform: translateX(-50%) translateY(-15px) scale(0.95);
  }
  to { 
    opacity: 1; 
    transform: translateX(-50%) translateY(0) scale(1);
  }
}

/* ✅ COMPACT BUTTON LOADING STATE */
.btn-loading {
  opacity: 0.8;
  cursor: not-allowed;
  pointer-events: none;
}

.btn-loading i {
  animation: spin 1s linear infinite;
}

@keyframes spin {
  from { transform: rotate(0deg); }
  to { transform: rotate(360deg); }
}

/* ✅ ENHANCED COMPLETED ITEM STYLING */
.completed-item {
  background: linear-gradient(135deg, rgba(76, 175, 80, 0.05), rgba(76, 175, 80, 0.02));
  border-left: 4px solid var(--success);
  transition: all 0.3s ease;
}

.completed-item:hover {
  background: linear-gradient(135deg, rgba(76, 175, 80, 0.08), rgba(76, 175, 80, 0.04));
  transform: translateY(-1px);
}


    @keyframes slideDown {
        from { opacity: 0; transform: translateX(-50%) translateY(-20px); }
        to { opacity: 1; transform: translateX(-50%) translateY(0); }
    }

    /* Scrollbar with luxe styling */
    ::-webkit-scrollbar {
        width: 4px;
    }

    ::-webkit-scrollbar-track {
        background: rgba(6, 13, 12, 0.1);
    }

    ::-webkit-scrollbar-thumb {
        background: linear-gradient(135deg, #060D0C, #1a1f1e);
        border-radius: 2px;
    }

    /* Badge Styles */
    .badge-primary {
        background: linear-gradient(135deg, #060D0C, #1a1f1e);
        color: #F0EDE5;
    }

    .badge-success {
        background: #4CAF50;
        color: white;
    }

    .badge-error {
        background: #E63946;
        color: white;
    }

    .badge-neutral {
        background: rgba(6, 13, 12, 0.1);
        color: #060D0C;
    }

.instagram-notification {
  position: fixed;
  top: 20px;
  left: 50%;
  transform: translateX(-50%) translateY(-100px);
  z-index: 1000;
  opacity: 0;
  transition: all 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94);
  pointer-events: none;
}

.instagram-notification.show {
  transform: translateX(-50%) translateY(0);
  opacity: 1;
}

.instagram-notification.hide {
  transform: translateX(-50%) translateY(-100px);
  opacity: 0;
}

.notification-content {
  background: rgba(255, 255, 255, 0.95);
  backdrop-filter: blur(20px);
  border-radius: 16px;
  padding: 16px 20px;
  display: flex;
  align-items: center;
  gap: 12px;
  box-shadow: 
    0 8px 32px rgba(0, 0, 0, 0.12),
    0 2px 8px rgba(0, 0, 0, 0.08),
    inset 0 1px 0 rgba(255, 255, 255, 0.5);
  border: 1px solid rgba(255, 255, 255, 0.3);
  min-width: 280px;
  max-width: 400px;
  animation: slideInBounce 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94);
}

@keyframes slideInBounce {
  0% {
    transform: translateY(-20px) scale(0.95);
    opacity: 0;
  }
  60% {
    transform: translateY(2px) scale(1.02);
    opacity: 0.9;
  }
  100% {
    transform: translateY(0) scale(1);
    opacity: 1;
  }
}

/* ✅ NOTIFICATION ICONS */
.notification-icon {
  width: 36px;
  height: 36px;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  flex-shrink: 0;
  position: relative;
  overflow: hidden;
}

.notification-icon::before {
  content: '';
  position: absolute;
  inset: 0;
  border-radius: 50%;
  opacity: 0.1;
  animation: pulse 2s infinite;
}

.success-icon {
  background: linear-gradient(135deg, var(--success), #388e3c);
  color: white;
}

.success-icon::before {
  background: var(--success);
}

.error-icon {
  background: linear-gradient(135deg, var(--error), #c62828);
  color: white;
}

.error-icon::before {
  background: var(--error);
}

.warning-icon {
  background: linear-gradient(135deg, var(--warning), #f57c00);
  color: white;
}

.warning-icon::before {
  background: var(--warning);
}

.notification-icon i {
  font-size: 16px;
  z-index: 1;
  position: relative;
}

/* ✅ NOTIFICATION TEXT */
.notification-text {
  flex: 1;
  min-width: 0;
}

.notification-message {
  font-family: 'Poppins', sans-serif;
  font-size: 14px;
  font-weight: 600;
  color: var(--noir);
  line-height: 1.4;
  letter-spacing: -0.01em;
  display: block;
}

/* ✅ PULSE ANIMATION */
@keyframes pulse {
  0%, 100% {
    transform: scale(1);
    opacity: 0.1;
  }
  50% {
    transform: scale(1.1);
    opacity: 0.2;
  }
}

/* ✅ DARK MODE VARIANT */
.notification-content.dark {
  background: rgba(6, 13, 12, 0.95);
  border: 1px solid rgba(255, 255, 255, 0.1);
}

.notification-content.dark .notification-message {
  color: var(--oat);
}

/* ✅ MOBILE RESPONSIVE */
@media (max-width: 480px) {
  .instagram-notification {
    top: 16px;
    left: 16px;
    right: 16px;
    transform: translateY(-100px);
  }
  
  .instagram-notification.show {
    transform: translateY(0);
  }
  
  .instagram-notification.hide {
    transform: translateY(-100px);
  }
  
  .notification-content {
    min-width: auto;
    max-width: none;
    padding: 14px 16px;
  }
  
  .notification-icon {
    width: 32px;
    height: 32px;
  }
  
  .notification-icon i {
    font-size: 14px;
  }
  
  .notification-message {
    font-size: 13px;
  }
}

/* ✅ ADVANCED ENTRANCE ANIMATIONS */
.notification-content {
  animation: instagramSlide 0.5s cubic-bezier(0.34, 1.56, 0.64, 1);
}

@keyframes instagramSlide {
  0% {
    transform: translateY(-40px) scale(0.9);
    opacity: 0;
    filter: blur(4px);
  }
  60% {
    transform: translateY(4px) scale(1.02);
    opacity: 0.8;
    filter: blur(0px);
  }
  100% {
    transform: translateY(0) scale(1);
    opacity: 1;
    filter: blur(0px);
  }
}

/* ✅ HOVER EFFECTS */
.notification-content:hover {
  transform: translateY(-2px);
  box-shadow: 
    0 12px 40px rgba(0, 0, 0, 0.15),
    0 4px 12px rgba(0, 0, 0, 0.1),
    inset 0 1px 0 rgba(255, 255, 255, 0.6);
  transition: all 0.3s ease;
}

</style>


</head>

<body class="bg-paper min-h-screen">
  <!-- Minimal Header -->
 <!-- Minimal Header -->
 <!-- Add this loading screen to your HTML body -->
<div id="authLoadingScreen" class="fixed inset-0 bg-paper z-50 flex items-center justify-center" style="display: none;">
    <div class="text-center">
      <div class="w-16 h-16 border-4 border-asphalt/20 border-t-asphalt rounded-full animate-spin mx-auto mb-4"></div>
      <h2 class="text-lg font-semibold text-asphalt mb-2">Loading...</h2>
      <p class="text-sm text-asphalt/60">Verifying your account</p>
    </div>
  </div>
  <header class="sticky top-0 z-50 bg-oat/90 backdrop-blur-md border-b border-noir/10">
    <div class="max-w-md mx-auto px-4 py-4">
      <div class="flex items-center justify-between">
        <!-- Menu Button -->
        <button onclick="toggleMenu()" class="w-10 h-10 rounded-lg bg-noir/5 hover:bg-noir/10 hover:text-noir flex items-center justify-center transition-colors">
          <i class="fas fa-bars text-noir text-sm"></i>
        </button>
  
        <!-- Title -->
        <div class="text-center">
          <h1 class="text-lg font-semibold text-noir tracking-tight">Smart Attendance</h1>
        </div>
  
        <!-- Profile with Luxe Gradient -->
        <div class="w-10 h-10 rounded-lg highlight flex items-center justify-center cursor-pointer" onclick="toggleMenu()">
          <span id="headerUserInitials" class="text-oat text-sm font-semibold">JD</span>
        </div>
      </div>
    </div>
  </header>
  <div id="mobileMenu" class="fixed inset-0 bg-noir/20 backdrop-blur-sm z-50 hidden">
    <div class="fixed left-0 top-0 h-full w-72 bg-oat shadow-2xl">
      <div class="flex flex-col h-full">
        
        <!-- Header Section -->
        <div class="p-6 border-b border-noir/10">
          <div class="flex justify-end mb-4">
            <button onclick="toggleMenu()" class="w-8 h-8 rounded-lg bg-noir/5 hover:bg-error/10 hover:text-error flex items-center justify-center transition-colors">
              <i class="fas fa-times text-noir text-sm"></i>
            </button>
          </div>
          
          <!-- Logo with luxe accent -->
         
          
          <!-- User Profile Card -->
          <div class="primary-state rounded-xl p-4 text-center">
            <!-- Avatar with Noir gradient -->
            <div class="w-16 h-16 highlight rounded-xl flex items-center justify-center mx-auto mb-3">
              <span id="userInitials" class="text-oat font-semibold text-xl">JD</span>
            </div>
            
            <!-- Email -->
            <p id="userEmail" class="text-sm text-noir/70">teacher@mla.edu</p>
          </div>
        </div>
        
        <!-- Navigation Menu -->
        <nav class="flex-1 px-4 py-6">
          <ul class="space-y-2">
            <li>
              <a href="myclass.html" class="w-full flex items-center gap-3 px-4 py-3 rounded-xl highlight text-oat font-medium">
                <i class="fas fa-home text-sm w-5"></i>
                <span>Dashboard</span>
              </a>
            </li>
            <li>
              <a href="promotion.html" class="w-full flex items-center gap-3 px-4 py-3 rounded-xl hover:bg-noir/5 hover:text-noir text-noir/70 transition-colors">
                <i class="fas fa-user-graduate text-sm w-5"></i>
                <span>Promote Students</span>
              </a>
            </li>
            <li>
              <a href="msg.html" class="w-full flex items-center gap-3 px-4 py-3 rounded-xl hover:bg-green-50 hover:text-green-600 text-noir/70 transition-colors">
                <i class="fas fa-comments text-sm w-5"></i>
                <span>WhatsApp</span>
              </a>
            </li>
            <li>
              <a href="report.html" class="w-full flex items-center gap-3 px-4 py-3 rounded-xl hover:bg-noir/5 hover:text-noir text-noir/70 transition-colors">
                <i class="fas fa-chart-bar text-sm w-5"></i>
                <span>Reports</span>
              </a>
            </li>
            <li>
              <a href="attendance.html" class="w-full flex items-center gap-3 px-4 py-3 rounded-xl hover:bg-noir/5 hover:text-noir text-noir/70 transition-colors">
                <i class="fas fa-calendar-check text-sm w-5"></i>
                <span>View Attendance</span>
              </a>
            </li>
          </ul>
        </nav>
        
        <!-- Logout Button -->
        <div class="p-4 border-t border-noir/10">
          <button onclick="logout()" class="w-full flex items-center gap-3 px-4 py-3 rounded-xl hover:bg-error/10 hover:text-error text-noir/70 transition-colors">
            <i class="fas fa-sign-out-alt text-sm w-5"></i>
            <span class="font-medium">Logout</span>
          </button>
        </div>
      </div>
    </div>
  </div>
    
      
  
  <!-- Main Content -->
  <main class="max-w-md mx-auto px-4 pb-6">
    <div id="homePage">
        <div class="glass-card rounded-2xl mt-4 overflow-hidden">
            <div class="flex border-b border-noir/5">
              <button class="tablinks flex-1 py-2 px-2 text-center text-xs font-medium" onclick="openTab(event, 'todayQueueTab')" id="defaultOpen">
                <span>Today's Classes</span>
              </button>
              
              <button class="tablinks flex-1 py-2 px-2 text-center text-xs font-medium" onclick="openTab(event, 'mySubjectsTab')">
                <span>Your Subjects</span>
              </button>
              
              <button class="tablinks flex-1 py-2 px-2 text-center text-xs font-medium" onclick="openTab(event, 'completedTab')">
                <span>Marked</span>
              </button>
            </div>
          </div>
          

       <!-- Tab Content -->
<div class="p-6">
  
    <!-- Today's Queue Tab -->
    <div id="todayQueueTab" class="tabcontent">
      <div class="mb-6">
        <h2 class="font-semibold text-noir mb-1">Today's Queue</h2>
        <p class="text-sm text-noir/60">Classes scheduled for today</p>
      </div>
      
      <div id="todayQueueContainer" class="space-y-3">
        <!-- Queue items will appear here -->
      </div>
  
      <div id="emptyQueuePrompt" class="text-center py-12">
        <div class="w-16 h-16 bg-noir/5 rounded-2xl flex items-center justify-center mx-auto mb-4">
          <i class="fas fa-plus text-noir/40 text-xl"></i>
        </div>
        <h3 class="font-medium text-noir mb-2">Queue is Empty</h3>
        <p class="text-sm text-noir/60 mb-6">Add subjects to start taking attendance</p>
        <button onclick="openSetupModal()" class="btn-primary px-6 py-3 rounded-xl font-medium shadow-lg">
          <i class="fas fa-cog mr-2"></i>Setup Subjects
        </button>
      </div>
    </div>
  
    <!-- My Subjects Tab -->
    <div id="mySubjectsTab" class="tabcontent">
      <div class="flex items-center justify-between mb-6">
        <div>
          <h2 class="font-semibold text-noir mb-1">My Subjects</h2>
          <p class="text-sm text-noir/60">All subjects you teach</p>
        </div>
        <button onclick="openSetupModal()" class="btn-secondary px-4 py-2 rounded-lg text-sm font-medium shadow-md">
          <i class="fas fa-plus text-xs mr-2"></i>Add
        </button>
      </div>
      
      <div id="mySubjectsContainer" class="space-y-3">
        <!-- Subjects will appear here -->
      </div>
  
      <div id="emptySubjectsPrompt" class="text-center py-12">
        <div class="w-16 h-16 bg-noir/5 rounded-2xl flex items-center justify-center mx-auto mb-4">
          <i class="fas fa-book text-noir/40 text-xl"></i>
        </div>
        <h3 class="font-medium text-noir mb-2">No Subjects Added</h3>
        <p class="text-sm text-noir/60 mb-6">Configure your subjects first</p>
        <button onclick="openSetupModal()" class="btn-primary px-6 py-3 rounded-xl font-medium shadow-lg">
          <i class="fas fa-book-open mr-2"></i>Add Subjects
        </button>
      </div>
    </div>
  
    <!-- Completed Tab -->
    <div id="completedTab" class="tabcontent">
      <div class="mb-6">
        <h2 class="font-semibold text-noir mb-1">Completed Today</h2>
        <p class="text-sm text-noir/60">Classes you've completed</p>
      </div>
      
      <div id="completedContainer" class="space-y-3">
        <!-- Completed items will appear here -->
      </div>
  
      <div id="emptyCompletedPrompt" class="text-center py-12">
        <div class="w-16 h-16 bg-noir/5 rounded-2xl flex items-center justify-center mx-auto mb-4">
          <i class="fas fa-calendar-check text-noir/40 text-xl"></i>
        </div>
        <h3 class="font-medium text-noir mb-2">No Completed Classes</h3>
        <p class="text-sm text-noir/60">Complete some classes to see them here</p>
      </div>
    </div>
  
  </div>
  
  <!-- Add Class Form -->
  <div id="addClassPage" class="hidden">
    <div class="glass-card rounded-2xl p-6 mt-4 border border-noir/10 shadow-xl">
      <div class="mb-6">
        <h2 class="font-semibold text-noir mb-1">Add New Class</h2>
        <p class="text-sm text-noir/60">Select class details for your queue</p>
      </div>
  
      <form id="addClassForm" class="space-y-4">
        <div>
          <label class="block text-sm font-medium text-noir mb-2">
            <i class="fas fa-stream text-noir/60 mr-2"></i>Stream
          </label>
          <select id="streamSelect" required class="w-full px-4 py-3 form-input rounded-xl border border-noir/20 focus:border-noir focus:ring-2 focus:ring-noir/10 transition-all">
            <option value="">Select stream</option>
          </select>
        </div>
  
        <div>
          <label class="block text-sm font-medium text-noir mb-2">
            <i class="fas fa-calendar-alt text-noir/60 mr-2"></i>Semester
          </label>
          <select id="semester" required class="w-full px-4 py-3 form-input rounded-xl border border-noir/20 focus:border-noir focus:ring-2 focus:ring-noir/10 transition-all">
            <option value="">Select semester</option>
            <option value="1">Semester 1</option>
            <option value="2">Semester 2</option>
            <option value="3">Semester 3</option>
            <option value="4">Semester 4</option>
            <option value="5">Semester 5</option>
            <option value="6">Semester 6</option>
          </select>
        </div>
  
        <div>
          <label class="block text-sm font-medium text-noir mb-2">
            <i class="fas fa-book text-noir/60 mr-2"></i>Subject
          </label>
          <select id="subject" required class="w-full px-4 py-3 form-input rounded-xl border border-noir/20 focus:border-noir focus:ring-2 focus:ring-noir/10 transition-all" disabled>
            <option value="">Select stream & semester first</option>
          </select>
        </div>
  
        <div class="flex gap-3 pt-4">
          <button type="submit" id="addBtn" class="btn-primary px-6 py-3 rounded-xl font-medium flex-1 shadow-lg disabled:opacity-50 disabled:cursor-not-allowed" disabled>
            <i class="fas fa-plus mr-2"></i>Add to Queue
          </button>
          <button type="button" onclick="hideAddClassForm()" class="btn-secondary px-6 py-3 rounded-xl font-medium shadow-md">
            <i class="fas fa-arrow-left mr-2"></i>Back
          </button>
        </div>
      </form>
    </div>
  </div>
  
  <!-- Setup Modal -->
  <div id="setupModal" class="fixed inset-0 bg-noir/30 backdrop-blur-md flex items-center justify-center p-4 hidden z-50">
    <div class="bg-oat rounded-2xl p-6 max-w-sm w-full max-h-[90vh] overflow-y-auto shadow-2xl border border-noir/20">
      <div class="flex justify-between items-center mb-6">
        <h2 class="font-semibold text-noir">Setup Subjects</h2>
        <button onclick="closeSetupModal()" class="w-8 h-8 rounded-lg bg-noir/5 hover:bg-noir/10 flex items-center justify-center transition-colors">
          <i class="fas fa-times text-noir text-sm"></i>
        </button>
      </div>
  
      <div class="space-y-4">
        <div>
          <label class="block text-sm font-medium text-noir mb-2">
            <i class="fas fa-graduation-cap text-noir/60 mr-2"></i>Stream
          </label>
          <select id="setupStream" class="w-full px-4 py-3 form-input rounded-xl border border-noir/20 focus:border-noir focus:ring-2 focus:ring-noir/10 transition-all">
            <option value="">Choose stream...</option>
          </select>
        </div>
  
        <div>
          <label class="block text-sm font-medium text-noir mb-2">
            <i class="fas fa-calendar text-noir/60 mr-2"></i>Semester
          </label>
          <select id="setupSemester" class="w-full px-4 py-3 form-input rounded-xl border border-noir/20 focus:border-noir focus:ring-2 focus:ring-noir/10 transition-all">
            <option value="">Choose semester...</option>
            <option value="1">Semester 1</option>
            <option value="2">Semester 2</option>
            <option value="3">Semester 3</option>
            <option value="4">Semester 4</option>
            <option value="5">Semester 5</option>
            <option value="6">Semester 6</option>
          </select>
        </div>
  
        <div>
          <label class="block text-sm font-medium text-noir mb-2">
            <i class="fas fa-list text-noir/60 mr-2"></i>Subjects
          </label>
          <div id="subjectSelector" class="max-h-40 overflow-y-auto border border-noir/20 rounded-xl p-3 bg-oat/80 backdrop-blur-sm">
            <p class="text-center text-noir/60 text-sm">Select stream and semester first</p>
          </div>
        </div>
  
        <div class="flex gap-3 pt-4">
          <button onclick="saveMySubjects()" class="btn-success px-6 py-3 rounded-xl font-medium flex-1 shadow-lg">
            <i class="fas fa-save mr-2"></i>Save
          </button>
          <button onclick="closeSetupModal()" class="btn-secondary px-6 py-3 rounded-xl font-medium shadow-md">
            <i class="fas fa-times mr-2"></i>Cancel
          </button>
        </div>
      </div>
    </div>
  </div>
  
  <script>
    // Set "Today's Classes" as default tab on page load
document.addEventListener('DOMContentLoaded', function() {
    // Automatically click the default tab
    const defaultTab = document.getElementById('defaultOpen');
    if (defaultTab) {
      defaultTab.click();
    }
  });
  
  // Tab switching function
  function openTab(evt, tabName) {
    var i, tabcontent, tablinks;
    
    // Hide all tab content
    tabcontent = document.getElementsByClassName('tabcontent');
    for (i = 0; i < tabcontent.length; i++) {
      tabcontent[i].style.display = 'none';
    }
    
    // Remove active class from all tab buttons
    tablinks = document.getElementsByClassName('tablinks');
    for (i = 0; i < tablinks.length; i++) {
      tablinks[i].classList.remove('active');
    }
    
    // Show selected tab content and mark button as active
    document.getElementById(tabName).style.display = 'block';
    evt.currentTarget.classList.add('active');
  }
  
    // Enhanced streams configuration
    const streams = [
      { name: "BCA", displayName: "BCA", icon: "fas fa-laptop-code", color: "bg-blue-50", textColor: "text-blue-600" },
      { name: "BBA", displayName: "BBA", icon: "fas fa-chart-line", color: "bg-green-50", textColor: "text-green-600" },
      { name: "BCom", displayName: "BCom", icon: "fas fa-money-bill-wave", color: "bg-yellow-50", textColor: "text-yellow-600" },
      { name: "BCom Section B", displayName: "BCom B", icon: "fas fa-money-bill-wave", color: "bg-purple-50", textColor: "text-purple-600", limitedSemesters: [5, 6] },
      { name: "BCom-BDA", displayName: "BDA", icon: "fas fa-chart-bar", color: "bg-purple-50", textColor: "text-purple-600" },
      { name: "BCom A and F", displayName: "BCom A and F", icon: "fas fa-calculator", color: "bg-blue-50", textColor: "text-blue-600" }
    ];

    // Global variables
    let mySubjects = [];
    let todayQueue = [];
    let completedToday = [];
    let teacherId = 'current_teacher';

    // Tab switching function
    function openTab(evt, tabName) {
      const tabContents = document.getElementsByClassName('tabcontent');
      for (let i = 0; i < tabContents.length; i++) {
        tabContents[i].classList.remove('active');
      }

      const tabButtons = document.getElementsByClassName('tablinks');
      for (let i = 0; i < tabButtons.length; i++) {
        tabButtons[i].classList.remove('active');
      }

      document.getElementById(tabName).classList.add('active');
      evt.currentTarget.classList.add('active');
    }

    // Initialize on page load
    document.addEventListener('DOMContentLoaded', async () => {
      await loadTeacherData();
      renderAllSections();
      checkNewDay();
      
      // Open default tab
      document.getElementById('defaultOpen').click();
    });

    // Load teacher data
    async function loadTeacherData() {
      try {
        const response = await fetch(`/api/teacher/${teacherId}/subjects`);
        if (response.ok) {
          const data = await response.json();
          mySubjects = data.subjects || [];
        } else {
          throw new Error('Database not available');
        }
      } catch (error) {
        mySubjects = JSON.parse(localStorage.getItem('mySubjects') || '[]');
      }

      todayQueue = JSON.parse(localStorage.getItem('todayQueue') || '[]');
      completedToday = JSON.parse(localStorage.getItem('completedToday') || '[]');
    }

    // Save teacher data
    async function saveTeacherData() {
      localStorage.setItem('mySubjects', JSON.stringify(mySubjects));
      localStorage.setItem('todayQueue', JSON.stringify(todayQueue));
      localStorage.setItem('completedToday', JSON.stringify(completedToday));

      try {
        await fetch(`/api/teacher/${teacherId}/subjects`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ subjects: mySubjects })
        });
      } catch (error) {
        console.log('Saved to localStorage only');
      }
    }

    // Render all sections
    function renderAllSections() {
      renderMySubjects();
      renderTodayQueue();
      renderCompleted();
      updateCounts();
    }

    // Update badge counts
    function updateCounts() {
      document.getElementById('subjectsBadge').textContent = mySubjects.length;
      document.getElementById('queueBadge').textContent = todayQueue.length;
      document.getElementById('completedBadge').textContent = completedToday.length;
    }

    // Render my subjects
    function renderMySubjects() {
      const container = document.getElementById('mySubjectsContainer');
      const emptyPrompt = document.getElementById('emptySubjectsPrompt');
      
      if (mySubjects.length === 0) {
        container.innerHTML = '';
        emptyPrompt.classList.remove('hidden');
        return;
      }

      emptyPrompt.classList.add('hidden');
      container.innerHTML = mySubjects.map(subj => {
        const isInQueue = todayQueue.some(q => q.subject === subj.subject && q.stream === subj.stream && q.semester == subj.semester);
        const isCompleted = completedToday.some(c => c.subject === subj.subject && c.stream === subj.stream && c.semester == subj.semester);
        
        return `
          <div class="glass-card p-4 rounded-xl flex items-center justify-between">
            <div class="flex-1">
              <h3 class="font-medium text-asphalt">${subj.subject}</h3>
              <p class="text-sm text-asphalt/60">${subj.stream} • Sem ${subj.semester}</p>
            </div>
            <div>
              ${isCompleted ? 
                '<span class="bg-green-500 text-white px-3 py-1 rounded-full text-xs font-medium">Done</span>' :
                isInQueue ? 
                  '<span class="bg-asphalt/10 text-asphalt px-3 py-1 rounded-full text-xs font-medium">Queued</span>' :
                  `<button onclick="addToQueue('${subj.subject}', '${subj.stream}', '${subj.semester}')" class="btn-primary px-4 py-2 rounded-lg text-sm font-medium">Add</button>`
              }
            </div>
          </div>
        `;
      }).join('');
    }

   // ✅ RENDER TODAY'S QUEUE - LUXE DESIGN
   function renderTodayQueue() {
    const container = document.getElementById('todayQueueContainer');
    const emptyPrompt = document.getElementById('emptyQueuePrompt');
  
    if (todayQueue.length === 0) {
      container.innerHTML = '';
      emptyPrompt.classList.remove('hidden');
      return;
    }
  
    emptyPrompt.classList.add('hidden');
    container.innerHTML = todayQueue.map((item, index) => {
      return `
        <div class="glass-card p-3 rounded-lg border-l-3 border-noir shadow-md hover:shadow-lg transition-all duration-300 max-w-xl mx-auto">
          <div class="flex items-start justify-between mb-3">
            <div class="flex items-start flex-1">
              <div class="w-7 h-7 bg-noir/10 rounded-md flex items-center justify-center mr-3 text-noir font-bold text-xs">
                ${index + 1}
              </div>
              <div class="flex-1 min-w-0">
                <h3 class="font-semibold text-noir text-sm mb-1 truncate">${item.subject}</h3>
                <p class="text-xs text-noir/70 font-medium">${item.stream} • Sem ${item.semester}</p>
                <p class="text-xs text-noir/50 mt-1 flex items-center">
                  <i class="fas fa-clock mr-1 text-xs"></i>
                  ${new Date(item.addedAt).toLocaleTimeString('en-IN', { 
                    hour: '2-digit', 
                    minute: '2-digit' 
                  })}
                </p>
              </div>
            </div>
          </div>
          
          <div class="flex gap-2">
            <button 
              onclick="takeAttendance('${item.id}')" 
              class="btn-primary px-3 py-2 rounded-lg font-medium text-xs flex-1 shadow-sm hover:shadow-md transition-all duration-300"
            >
              <i class="fas fa-clipboard-check mr-1 text-xs"></i>
             Take Attendance
            </button>
            <button 
              onclick="removeFromQueue('${item.id}')" 
              class="btn-secondary px-2 py-2 rounded-lg text-xs font-medium shadow-sm hover:shadow-md transition-all duration-300"
            >
              <i class="fas fa-times text-xs"></i>
            </button>
          </div>
        </div>
      `;
    }).join('');
  }
  

// ✅ SMART TIME RANGE FORMATTING - SHOWS HOURLY SLOTS
function formatAttendanceTimeRange(dateString) {
  const date = new Date(dateString);
  const currentHour = date.getHours();
  
  // Current hour formatting
  let startHour = currentHour % 12;
  if (startHour === 0) startHour = 12;
  const startAMPM = currentHour >= 12 ? 'PM' : 'AM';
  
  // Next hour formatting
  const nextHour24 = (currentHour + 1) % 24;
  let endHour = nextHour24 % 12;
  if (endHour === 0) endHour = 12;
  const endAMPM = nextHour24 >= 12 ? 'PM' : 'AM';
  
  return `${startHour}:00 ${startAMPM} - ${endHour}:00 ${endAMPM}`;
}

// ✅ ADD TO QUEUE - COMPACT
function addToQueue(subject, stream, semester) {
  const newItem = {
    id: Date.now() + Math.random(),
    subject: subject,
    stream: stream,
    semester: parseInt(semester),
    addedAt: new Date().toISOString()
  };

  todayQueue.push(newItem);
  saveTeacherData();
  renderAllSections();
  updateCounts();
  
  showSuccessMessage(`✅ ${subject} added to queue`);
}

// ✅ FIXED TAKE ATTENDANCE FUNCTION
function takeAttendance(itemId) {
  const item = todayQueue.find(q => q.id == itemId);
  if (!item) {
    showErrorMessage('❌ Class not found in queue');
    return;
  }

  const button = event.target.closest('button');
  const originalContent = button.innerHTML;
  button.innerHTML = '<i class="fas fa-spinner fa-spin mr-1"></i>Processing...';
  button.disabled = true;

  try {
    const itemIndex = todayQueue.findIndex(q => q.id == itemId);
    const removedItem = todayQueue.splice(itemIndex, 1)[0];
    
    // ✅ Use time range formatting
    const completedItem = {
      ...removedItem,
      completedAt: new Date().toISOString(),
      completedTime: formatAttendanceTimeRange(new Date()), // ✅ Shows "11:00 AM - 12:00 PM"
      status: 'completed'
    };
    
    completedToday.push(completedItem);
    
    saveTeacherData();
    renderAllSections();
    updateCounts();
    
    showSuccessMessage(`📋 Taking attendance for ${item.subject}`);

    const classInfo = {
      stream: item.stream,
      semester: item.semester,
      subject: item.subject,
      classId: itemId,
      queueItemId: itemId,
      timestamp: new Date().toISOString(),
      source: 'queue',
      teacherName: localStorage.getItem('userName') || 'Teacher',
      addedAt: item.addedAt
    };

    sessionStorage.setItem('selectedClass', JSON.stringify(classInfo));
    
    // ✅ FIXED: Navigate to mark.html instead of index.html
    setTimeout(() => {
      window.location.href = 'index.html';
    }, 1200);

  } catch (error) {
    console.error('Error taking attendance:', error);
    button.innerHTML = originalContent;
    button.disabled = false;
    showErrorMessage('❌ Failed to process attendance');
  }
}

// ✅ RENDER COMPLETED - WITH COMPACT DESIGN
function renderCompleted() {
  const container = document.getElementById('completedContainer');
  const emptyPrompt = document.getElementById('emptyCompletedPrompt');

  if (completedToday.length === 0) {
    container.innerHTML = '';
    emptyPrompt.classList.remove('hidden');
    return;
  }

  emptyPrompt.classList.add('hidden');
  container.innerHTML = completedToday.map(item => {
    return `
      <div class="glass-card p-3 rounded-lg border-l-3 border-success shadow-md hover:shadow-lg transition-all duration-300 bg-success/5 max-w-sm mx-auto">
        <div class="flex items-center justify-between">
          <div class="flex items-center flex-1">
            <div class="w-7 h-7 bg-success rounded-lg flex items-center justify-center mr-3">
              <i class="fas fa-check text-white text-xs"></i>
            </div>
            <div class="flex-1 min-w-0">
              <h3 class="font-semibold text-noir text-sm mb-1 truncate">${item.subject}</h3>
              <p class="text-xs text-noir/70 font-medium">${item.stream} • Sem ${item.semester}</p>
              <p class="text-xs text-success font-bold mt-1 flex items-center">
                <i class="fas fa-clock mr-1"></i>
                ${item.completedTime} ✓
              </p>
            </div>
          </div>
          <div class="flex gap-1">
            <button 
              onclick="addToQueueFromCompleted('${item.id}')" 
              class="px-2 py-1 rounded-md text-xs font-medium bg-noir/10 hover:bg-noir/20 text-noir transition-all duration-300"
            >
              <i class="fas fa-redo text-xs"></i>
            </button>
          </div>
        </div>
      </div>
    `;
  }).join('');
}

// ✅ ADDITIONAL HELPER FUNCTIONS
function removeFromQueue(itemId) {
  const item = todayQueue.find(q => q.id == itemId);
  if (!item) return;

  if (confirm(`Remove "${item.subject}" from today's queue?`)) {
    const itemIndex = todayQueue.findIndex(q => q.id == itemId);
    todayQueue.splice(itemIndex, 1);
    
    saveTeacherData();
    renderAllSections();
    updateCounts();
    
    showSuccessMessage(`🗑️ ${item.subject} removed from queue`);
  }
}

function addToQueueFromCompleted(itemId) {
  const item = completedToday.find(c => c.id == itemId);
  if (!item) return;

  if (confirm(`Re-add "${item.subject}" to today's queue?`)) {
    // Remove from completed
    const itemIndex = completedToday.findIndex(c => c.id == itemId);
    const removedItem = completedToday.splice(itemIndex, 1)[0];
    
    // Add back to queue with new timestamp
    const queueItem = {
      id: Date.now() + Math.random(),
      subject: removedItem.subject,
      stream: removedItem.stream,
      semester: removedItem.semester,
      addedAt: new Date().toISOString()
    };
    
    todayQueue.push(queueItem);
    
    saveTeacherData();
    renderAllSections();
    updateCounts();
    
    showSuccessMessage(`🔄 ${item.subject} re-added to queue`);
  }
}

// ✅ COMPACT SUCCESS MESSAGE
function showSuccessMessage(message) {
  const existing = document.querySelector('.notification');
  if (existing) existing.remove();

  const notification = document.createElement('div');
  notification.className = 'notification fixed top-4 left-1/2 transform -translate-x-1/2 z-50 px-4 py-3 rounded-lg shadow-lg backdrop-blur-md border border-noir/10';
  notification.style.background = 'linear-gradient(135deg, var(--noir) 0%, #1a1f1e 100%)';
  notification.style.color = 'var(--oat)';
  notification.style.fontSize = '0.85rem';
  notification.style.fontWeight = '600';
  notification.style.fontFamily = "'Poppins', sans-serif";
  
  notification.innerHTML = `
    <div style="display: flex; align-items: center; gap: 8px;">
      <div style="width: 20px; height: 20px; background: var(--success); border-radius: 6px; display: flex; align-items: center; justify-content: center;">
        <i class="fas fa-check" style="font-size: 10px; color: white;"></i>
      </div>
      <span>${message}</span>
    </div>
  `;
  
  document.body.appendChild(notification);
  
  setTimeout(() => {
    notification.style.opacity = '0';
    notification.style.transform = 'translateX(-50%) translateY(-8px)';
    setTimeout(() => notification.remove(), 250);
  }, 2500);
}
// ✅ INSTAGRAM-STYLE SUCCESS MESSAGE
function showSuccessMessage(message) {
  const existing = document.querySelector('.instagram-notification');
  if (existing) existing.remove();

  const notification = document.createElement('div');
  notification.className = 'instagram-notification';
  
  notification.innerHTML = `
    <div class="notification-content">
      <div class="notification-icon success-icon">
        <i class="fas fa-check"></i>
      </div>
      <div class="notification-text">
        <span class="notification-message">${message}</span>
      </div>
    </div>
  `;
  
  document.body.appendChild(notification);
  
  // Trigger entrance animation
  setTimeout(() => notification.classList.add('show'), 10);
  
  // Auto remove
  setTimeout(() => {
    notification.classList.add('hide');
    setTimeout(() => notification.remove(), 400);
  }, 3000);
}

// ✅ INSTAGRAM-STYLE ERROR MESSAGE
function showErrorMessage(message) {
  const existing = document.querySelector('.instagram-notification');
  if (existing) existing.remove();

  const notification = document.createElement('div');
  notification.className = 'instagram-notification';
  
  notification.innerHTML = `
    <div class="notification-content">
      <div class="notification-icon error-icon">
        <i class="fas fa-exclamation-triangle"></i>
      </div>
      <div class="notification-text">
        <span class="notification-message">${message}</span>
      </div>
    </div>
  `;
  
  document.body.appendChild(notification);
  
  // Trigger entrance animation
  setTimeout(() => notification.classList.add('show'), 10);
  
  // Auto remove
  setTimeout(() => {
    notification.classList.add('hide');
    setTimeout(() => notification.remove(), 400);
  }, 4000);
}

// ✅ INSTAGRAM-STYLE WARNING MESSAGE
function showWarningMessage(message) {
  const existing = document.querySelector('.instagram-notification');
  if (existing) existing.remove();

  const notification = document.createElement('div');
  notification.className = 'instagram-notification';
  
  notification.innerHTML = `
    <div class="notification-content">
      <div class="notification-icon warning-icon">
        <i class="fas fa-exclamation-circle"></i>
      </div>
      <div class="notification-text">
        <span class="notification-message">${message}</span>
      </div>
    </div>
  `;
  
  document.body.appendChild(notification);
  
  // Trigger entrance animation
  setTimeout(() => notification.classList.add('show'), 10);
  
  // Auto remove
  setTimeout(() => {
    notification.classList.add('hide');
    setTimeout(() => notification.remove(), 400);
  }, 3500);
}



// ✅ REMOVE FROM QUEUE - COMPACT
function removeFromQueue(itemId) {
  const item = todayQueue.find(q => q.id == itemId);
  if (!item) return;

  if (confirm(`Remove "${item.subject}" from today's queue?`)) {
    const itemIndex = todayQueue.findIndex(q => q.id == itemId);
    todayQueue.splice(itemIndex, 1);
    
    saveTeacherData();
    renderAllSections();
    updateCounts();
    
    showSuccessMessage(`🗑️ ${item.subject} removed`);
  }
}

// ✅ RE-ADD FROM COMPLETED - COMPACT
function addToQueueFromCompleted(itemId) {
  const item = completedToday.find(c => c.id == itemId);
  if (!item) return;

  if (confirm(`Re-add "${item.subject}" to queue?`)) {
    // Remove from completed
    const itemIndex = completedToday.findIndex(c => c.id == itemId);
    const removedItem = completedToday.splice(itemIndex, 1)[0];
    
    // Add back to queue
    const queueItem = {
      id: Date.now() + Math.random(),
      subject: removedItem.subject,
      stream: removedItem.stream,
      semester: removedItem.semester,
      addedAt: new Date().toISOString()
    };
    
    todayQueue.push(queueItem);
    
    saveTeacherData();
    renderAllSections();
    updateCounts();
    
    showSuccessMessage(`🔄 ${item.subject} re-added`);
  }
}

// ✅ COMPACT SUCCESS MESSAGE - LUXE DESIGN
function showSuccessMessage(message) {
  const existing = document.querySelector('.notification');
  if (existing) existing.remove();

  const notification = document.createElement('div');
  notification.className = 'notification fixed top-4 left-1/2 transform -translate-x-1/2 z-50 px-4 py-3 rounded-lg shadow-lg backdrop-blur-md border border-noir/10';
  notification.style.background = 'linear-gradient(135deg, var(--noir) 0%, #1a1f1e 100%)';
  notification.style.color = 'var(--oat)';
  notification.style.fontSize = '0.85rem';
  notification.style.fontWeight = '600';
  notification.style.fontFamily = "'Poppins', sans-serif";
  
  notification.innerHTML = `
    <div style="display: flex; align-items: center; gap: 8px;">
      <div style="width: 20px; height: 20px; background: var(--success); border-radius: 6px; display: flex; align-items: center; justify-content: center;">
        <i class="fas fa-check" style="font-size: 10px; color: white;"></i>
      </div>
      <span>${message}</span>
    </div>
  `;
  
  document.body.appendChild(notification);
  
  // Auto-remove with animation
  setTimeout(() => {
    notification.style.opacity = '0';
    notification.style.transform = 'translateX(-50%) translateY(-8px)';
    setTimeout(() => notification.remove(), 250);
  }, 2500);
}

// ✅ COMPACT ERROR MESSAGE - LUXE DESIGN
function showErrorMessage(message) {
  const existing = document.querySelector('.notification');
  if (existing) existing.remove();

  const notification = document.createElement('div');
  notification.className = 'notification fixed top-4 left-1/2 transform -translate-x-1/2 z-50 px-4 py-3 rounded-lg shadow-lg backdrop-blur-md border border-error/20';
  notification.style.background = 'linear-gradient(135deg, var(--error) 0%, #c62828 100%)';
  notification.style.color = 'white';
  notification.style.fontSize = '0.85rem';
  notification.style.fontWeight = '600';
  notification.style.fontFamily = "'Poppins', sans-serif";
  
  notification.innerHTML = `
    <div style="display: flex; align-items: center; gap: 8px;">
      <div style="width: 20px; height: 20px; background: rgba(255,255,255,0.2); border-radius: 6px; display: flex; align-items: center; justify-content: center;">
        <i class="fas fa-exclamation-triangle" style="font-size: 10px; color: white;"></i>
      </div>
      <span>${message}</span>
    </div>
  `;
  
  document.body.appendChild(notification);
  
  // Auto-remove
  setTimeout(() => {
    notification.style.opacity = '0';
    notification.style.transform = 'translateX(-50%) translateY(-8px)';
    setTimeout(() => notification.remove(), 250);
  }, 3500);
}

// ✅ UPDATE COUNTS - COMPACT
function updateCounts() {
  const queueBadge = document.getElementById('queueBadge');
  const completedBadge = document.getElementById('completedBadge');
  
  if (queueBadge) queueBadge.textContent = todayQueue.length;
  if (completedBadge) completedBadge.textContent = completedToday.length;
}

// ✅ RENDER ALL SECTIONS - OPTIMIZED
function renderAllSections() {
  renderTodayQueue();
  renderMySubjects();
  renderCompleted();
  updateCounts();
}

// ✅ ENHANCED RENDER COMPLETED - WITH SMART TIME DISPLAY
function renderCompleted() {
  const container = document.getElementById('completedContainer');
  const emptyPrompt = document.getElementById('emptyCompletedPrompt');

  if (completedToday.length === 0) {
    container.innerHTML = '';
    emptyPrompt.classList.remove('hidden');
    return;
  }

  emptyPrompt.classList.add('hidden');
  container.innerHTML = completedToday.map(item => {
    return `
      <div class="glass-card p-4 rounded-xl border-l-4 border-success shadow-md hover:shadow-lg transition-all duration-300 bg-success/5">
        <div class="flex items-center justify-between">
          <div class="flex items-center flex-1">
            <div class="w-8 h-8 bg-success rounded-lg flex items-center justify-center mr-3">
              <i class="fas fa-check text-white text-sm"></i>
            </div>
            <div class="flex-1">
              <h3 class="font-semibold text-noir text-base mb-1">${item.subject}</h3>
              <p class="text-sm text-noir/70 font-medium">${item.stream} • Sem ${item.semester}</p>
              <p class="text-xs text-success font-bold mt-1 flex items-center">
                <i class="fas fa-clock mr-1"></i>
                Completed: ${item.completedTime} ✅ Smart hourly display
              </p>
            </div>
          </div>
          <div class="flex gap-2">
            <button 
              onclick="addToQueueFromCompleted('${item.id}')" 
              class="px-3 py-1 rounded-lg text-xs font-medium bg-noir/10 hover:bg-noir/20 text-noir transition-all duration-300"
            >
              <i class="fas fa-redo mr-1"></i>Re-add
            </button>
          </div>
        </div>
      </div>
    `;
  }).join('');
}



    // Other functions
    function addToQueueFromCompleted(itemId) {
      const completedIndex = completedToday.findIndex(c => c.id == itemId);
      if (completedIndex === -1) return;

      const item = completedToday[completedIndex];
      
      const queueItem = {
        id: item.id,
        subject: item.subject,
        stream: item.stream,
        semester: item.semester,
        addedAt: new Date().toISOString()
      };
      
      todayQueue.push(queueItem);
      completedToday.splice(completedIndex, 1);
      
      saveTeacherData();
      renderAllSections();
      showSuccessMessage(`${item.subject} added back to queue`);
    }

    function removeFromQueue(itemId) {
      if (confirm('Remove this subject from queue?')) {
        todayQueue = todayQueue.filter(q => q.id != itemId);
        saveTeacherData();
        renderAllSections();
      }
    }

    // Navigation functions
    function showHomePage() {
      document.getElementById('addClassPage').classList.add('hidden');
      document.getElementById('homePage').classList.remove('hidden');
    }

    function showAddClassForm() {
      document.getElementById('homePage').classList.add('hidden');
      document.getElementById('addClassPage').classList.remove('hidden');
      populateStreamDropdown();
    }

    function hideAddClassForm() {
      showHomePage();
    }

    // Setup functions
    function openSetupModal() {
      document.getElementById('setupModal').classList.remove('hidden');
      populateStreams();
    }

    function closeSetupModal() {
      document.getElementById('setupModal').classList.add('hidden');
    }

    function populateStreams() {
      const streamSelect = document.getElementById('setupStream');
      streamSelect.innerHTML = '<option value="">Choose stream...</option>';
      
      streams.forEach(stream => {
        const option = document.createElement('option');
        option.value = stream.name;
        option.textContent = stream.displayName || stream.name;
        streamSelect.appendChild(option);
      });
    }

    function populateStreamDropdown() {
      const streamSelect = document.getElementById('streamSelect');
      streamSelect.innerHTML = '<option value="">Select stream</option>';
      
      streams.forEach(stream => {
        const option = document.createElement('option');
        option.value = stream.name;
        option.textContent = stream.displayName || stream.name;
        streamSelect.appendChild(option);
      });
    }

    document.getElementById('setupStream').addEventListener('change', loadSubjectsForSetup);
    document.getElementById('setupSemester').addEventListener('change', loadSubjectsForSetup);

    async function loadSubjectsForSetup() {
      const stream = document.getElementById('setupStream').value;
      const semester = document.getElementById('setupSemester').value;
      const container = document.getElementById('subjectSelector');

      if (!stream || !semester) {
        container.innerHTML = '<p class="text-center text-asphalt/60 text-sm">Select stream and semester first</p>';
        return;
      }

      try {
        container.innerHTML = '<p class="text-center text-asphalt/60 text-sm">Loading...</p>';

        const response = await fetch(`/api/subjects/${stream}/sem${semester}`);
        const data = await response.json();
        const subjects = data.subjects || [];

        if (subjects.length === 0) {
          container.innerHTML = '<p class="text-center text-asphalt/60 text-sm">No subjects found</p>';
          return;
        }

        container.innerHTML = subjects.map(subject => {
          const subjectName = subject.subjectName || subject.name || subject;
          const isSelected = mySubjects.some(s => 
            s.subject === subjectName && 
            s.stream === stream && 
            s.semester == semester
          );
          
          return `
            <label class="flex items-center p-2 hover:bg-asphalt/5 rounded cursor-pointer">
              <input type="checkbox" ${isSelected ? 'checked' : ''} 
                     data-subject="${subjectName}" 
                     data-stream="${stream}" 
                     data-semester="${semester}"
                     class="mr-3 w-4 h-4">
              <span class="text-sm text-asphalt">${subjectName}</span>
            </label>
          `;
        }).join('');

      } catch (error) {
        container.innerHTML = '<p class="text-center text-red-500 text-sm">Error loading subjects</p>';
      }
    }

    async function saveMySubjects() {
      const checkboxes = document.querySelectorAll('#subjectSelector input[type="checkbox"]:checked');
      const selectedSubjects = [];

      checkboxes.forEach(checkbox => {
        selectedSubjects.push({
          subject: checkbox.dataset.subject,
          stream: checkbox.dataset.stream,
          semester: parseInt(checkbox.dataset.semester)
        });
      });

      if (selectedSubjects.length === 0) {
        alert('Please select at least one subject');
        return;
      }

      selectedSubjects.forEach(newSubj => {
        const exists = mySubjects.some(existing => 
          existing.subject === newSubj.subject && 
          existing.stream === newSubj.stream && 
          existing.semester === newSubj.semester
        );
        
        if (!exists) {
          mySubjects.push(newSubj);
        }
      });

      await saveTeacherData();
      renderAllSections();
      closeSetupModal();
      
      showSuccessMessage(`Added ${selectedSubjects.length} subjects`);
    }

    function checkNewDay() {
      const today = new Date().toDateString();
      const lastDate = localStorage.getItem('lastActiveDate');
      
      if (lastDate !== today) {
        todayQueue = [];
        completedToday = [];
        localStorage.setItem('lastActiveDate', today);
        saveTeacherData();
      }
    }

    // Mobile menu functions
    function toggleMenu() {
        const menu = document.getElementById('mobileMenu');
        menu.classList.toggle('hidden');
      }
      
      function logout() {
        if (confirm('Are you sure you want to logout?')) {
          localStorage.clear();
          sessionStorage.clear();
          window.location.href = 'login.html';
        }
      }
      
      // Close menu when clicking outside
      document.getElementById('mobileMenu').addEventListener('click', function(e) {
        if (e.target === this) {
          toggleMenu();
        }
      });
      
      // ✅ SIMPLE USER DISPLAY - AVATAR & EMAIL ONLY
      function updateUserDisplay() {
        const userEmail = localStorage.getItem('userEmail') || 'teacher@mla.edu';
        const userName = localStorage.getItem('userName') || 'John Doe';
      
        // Generate initials from name
        const initials = userName
          .split(' ')
          .map(name => name.charAt(0))
          .join('')
          .toUpperCase()
          .substring(0, 2);
      
        // Update email
        const emailElement = document.getElementById('userEmail');
        if (emailElement) {
          emailElement.textContent = userEmail;
        }
      
        // Update avatar initials
        const avatarElement = document.getElementById('userInitials');
        if (avatarElement) {
          avatarElement.textContent = initials;
        }
      
        // Update header avatar too
        const headerAvatarElement = document.getElementById('headerUserInitials');
        if (headerAvatarElement) {
          headerAvatarElement.textContent = initials;
        }
      }
      
      // Update user display when page loads
      document.addEventListener('DOMContentLoaded', function() {
        updateUserDisplay();
      });
      
    
  </script>
  <script type="module">
    // ✅ ENHANCED FIREBASE AUTHENTICATION MODULE
    import { firebaseConfig } from './firebase-config.js';
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
    import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-auth.js";
    
    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    let authStateChecked = false;
    
    // ✅ ENHANCED LOADING FUNCTIONS
    function showAuthLoading() {
      console.log('🔄 Showing authentication loading...');
      const loadingScreen = document.getElementById('authLoadingScreen');
      const mainContent = document.getElementById('mainContent');
      
      if (loadingScreen) {
        loadingScreen.style.display = 'flex';
        loadingScreen.classList.remove('hidden');
      }
      if (mainContent) {
        mainContent.style.display = 'none';
        mainContent.classList.add('hidden');
      }
    }
    
    function hideAuthLoading() {
      console.log('✅ Hiding authentication loading...');
      const loadingScreen = document.getElementById('authLoadingScreen');
      const mainContent = document.getElementById('mainContent');
      
      if (loadingScreen) {
        loadingScreen.style.display = 'none';
        loadingScreen.classList.add('hidden');
      }
      if (mainContent) {
        mainContent.style.display = 'block';
        mainContent.classList.remove('hidden');
      }
    }
    
    // ✅ ENHANCED AUTHORIZATION CHECK
    function isAuthorizedUser(email) {
      // Enhanced email validation
      const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
      return email && emailRegex.test(email);
    }
    
    // ✅ MAIN AUTHENTICATION HANDLER
    onAuthStateChanged(auth, (user) => {
      authStateChecked = true;
      console.log('🔐 Auth state changed:', user ? 'Logged in' : 'Logged out');
    
      if (user) {
        const email = user.email;
        
        if (!email || !isAuthorizedUser(email)) {
          console.warn('❌ Unauthorized user detected');
          signOut(auth).then(() => {
            window.location.href = "login.html";
          });
          return;
        }
    
        console.log('✅ Authorized user:', email);
        updateUserInterface(user, email);
        hideAuthLoading();
    
      } else {
        console.log('❌ No user authenticated, redirecting...');
        setTimeout(() => {
          window.location.href = "login.html";
        }, 100);
      }
    });
    
    // ✅ ENHANCED USER INTERFACE UPDATE
    function updateUserInterface(user, email) {
      try {
        console.log('🔄 Updating user interface...');
        
        const userName = localStorage.getItem("userName") || user.displayName || extractNameFromEmail(email);
        const profilePhoto = user.photoURL;
        
        // ✅ UPDATE GLOBAL USER OBJECT
        if (typeof window.currentUser !== 'undefined') {
          window.currentUser = {
            name: userName,
            email: email,
            role: 'Teacher',
            institution: 'MLA AHL',
            profilePic: profilePhoto
          };
        }
        
        // ✅ UPDATE ALL USER ELEMENTS
        updateUserElements(userName, email, profilePhoto);
        
        // ✅ SAVE TO STORAGE
        localStorage.setItem("userName", userName);
        localStorage.setItem("userEmail", email);
        if (profilePhoto) localStorage.setItem("userPhoto", profilePhoto);
        
        console.log('✅ User interface updated successfully');
        
        // ✅ TRIGGER USER DISPLAY UPDATE
        setTimeout(() => {
          if (typeof window.updateUserDisplay === 'function') {
            window.updateUserDisplay();
          }
        }, 100);
    
      } catch (error) {
        console.error('❌ Error updating UI:', error);
      }
    }
    
    // ✅ HELPER FUNCTION TO EXTRACT NAME FROM EMAIL
    function extractNameFromEmail(email) {
      const name = email.split('@')[0];
      return name.charAt(0).toUpperCase() + name.slice(1).replace(/[._]/g, ' ');
    }
    
    // ✅ UPDATE ALL USER ELEMENTS IN THE DOM
    function updateUserElements(userName, email, profilePhoto) {
      // Update user name elements
      const userNameElements = [
        document.getElementById("userName"),
        document.querySelector("[data-user-name]")
      ];
      
      userNameElements.forEach(el => {
        if (el) el.textContent = userName;
      });
      
      // Update user email elements
      const userEmailElements = [
        document.getElementById("userEmail"),
        document.querySelector("[data-user-email]")
      ];
      
      userEmailElements.forEach(el => {
        if (el) el.textContent = email;
      });
      
      // Update initials in avatars
      const initials = userName.split(' ').map(n => n.charAt(0)).join('').toUpperCase().substring(0, 2);
      
      const initialsElements = [
        document.getElementById("userInitials"),
        document.getElementById("headerUserInitials"),
        document.querySelector("[data-user-initials]")
      ];
      
      initialsElements.forEach(el => {
        if (el) el.textContent = initials;
      });
      
      // Update profile pictures if available
      if (profilePhoto) {
        const profileElements = [
          document.getElementById("profilePic"),
          document.querySelector("[data-user-photo]")
        ];
        
        profileElements.forEach(el => {
          if (el && el.tagName === 'IMG') {
            el.src = profilePhoto;
            el.onerror = () => {
              // Fallback to initials if image fails
              el.style.display = 'none';
              const initialsEl = el.nextElementSibling || el.previousElementSibling;
              if (initialsEl) initialsEl.style.display = 'flex';
            };
          }
        });
      }
    }
    
    // ✅ ENHANCED LOGOUT FUNCTION
    window.logout = async () => {
      try {
        console.log('🔄 Logout initiated...');
        
        // Show confirmation with custom styling
        const confirmLogout = confirm("Are you sure you want to logout?");
        
        if (!confirmLogout) {
          console.log('❌ Logout cancelled by user');
          return;
        }
        
        // Show loading state
        showAuthLoading();
        
        // Sign out from Firebase
        await signOut(auth);
        
        // Clear all stored data
        localStorage.clear();
        sessionStorage.clear();
        
        console.log('✅ Logout successful');
        
        // Show success message if function exists
        if (typeof window.showSuccessMessage === 'function') {
          window.showSuccessMessage('Logged out successfully');
        }
        
        // Redirect after short delay
        setTimeout(() => {
          window.location.href = "/login.html";
        }, 500);
        
      } catch (error) {
        console.error('❌ Logout error:', error);
        
        // Force logout even on error
        localStorage.clear();
        sessionStorage.clear();
        window.location.href = "/login.html";
      }
    };
    
    // ✅ ENHANCED NAVIGATION FUNCTION
    window.navigateToPage = (url) => {
      console.log('🔄 Navigating to:', url);
      
      // Close menu if it's open
      if (typeof window.toggleMenu === 'function') {
        const menu = document.getElementById('mobileMenu');
        if (menu && !menu.classList.contains('hidden')) {
          window.toggleMenu();
        }
      }
      
      // Navigate after short delay
      setTimeout(() => {
        window.location.href = url;
      }, 100);
    };
    
    // ✅ INITIALIZE AUTHENTICATION
    console.log('🚀 Initializing Firebase authentication...');
    showAuthLoading();
    
    // ✅ FALLBACK TIMEOUT
    setTimeout(() => {
      if (!authStateChecked) {
        console.warn('⚠️ Auth check timeout, redirecting to login...');
        window.location.href = "login.html";
      }
    }, 10000);
    
    // ✅ INTEGRATION WITH EXISTING APP
    window.addEventListener('DOMContentLoaded', () => {
      console.log('🔄 DOM loaded, integrating with existing app...');
      
      // Hide loading if DOM is ready and user is authenticated
      if (authStateChecked && auth.currentUser) {
        setTimeout(hideAuthLoading, 100);
      }
    });
    
    // ✅ EXPORT AUTH OBJECT FOR OTHER SCRIPTS
    window.firebaseAuth = auth;
    window.firebaseApp = app;
    
    console.log('✅ Firebase authentication module loaded');
</script>

    
</body>
</html>
